// import AxiosInstance from 'axios';

export default function useDirectusToken(directusApi) {

	const addQueryToPath = function (path, query) {
		const queryParams = [];

		for (const [key, value] of Object.entries(query)) {
			queryParams.push(`${key}=${value}`);
		}

		return path.includes('?') ? `${path}&${queryParams.join('&')}` : `${path}?${queryParams.join('&')}`;
	};

	const getToken = function () {
		return (
			directusApi.defaults?.headers?.['Authorization']?.split(' ')[1] ||
			directusApi.defaults?.headers?.common?.['Authorization']?.split(' ')[1] ||
			null
		);
	};

	const addTokenToURL = function (url, token) {
		const accessToken = token || getToken();
		if (!accessToken) return url;
		return addQueryToPath(url, {
			access_token: accessToken,
		});
	};

	return {
		addQueryToPath,
		getToken,
		addTokenToURL,
	};
}
